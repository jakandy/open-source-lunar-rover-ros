<?xml version="1.0" encoding="utf-8"?>

<!-- 
#  
# Title:
#  Open Source Lunar Rover (OSLR) - Rocker-bogie model
#
# Author(s):
#   andyjak
#
# Version:
#   0.0.1, 08/2023
#
# Purpose:
#   Contains the rocker-bogie suspension part of the model.
#
# Notes:
#   Include this file in the urdf file.
#   The geometry was generated using the urdf exporter for Solidworks.
#
# Test setup:
#   - ROS Noetic
#   - Ubuntu, 20.04 LTS
#   - Python 3.8.10
#
# References:
#   References are listed in the README.
#   Comments that include a [number] refers to the index in the reference list.
#
-->

<robot
  xmlns:xacro="http://ros.org/wiki/xacro"
  name="oslr_rockerbogie">
  
  <!-- ********************************** PARAMETER VALUES ********************************** -->
  <xacro:property name="rocker_limit_upper" value="${yaml_dict['rocker_limit_upper']}" />
  <xacro:property name="rocker_limit_lower" value="${yaml_dict['rocker_limit_lower']}" />
  <xacro:property name="friction_coeff1_bogie" value="${yaml_dict['friction_coeff1_bogie']}" />
  <xacro:property name="friction_coeff2_bogie" value="${yaml_dict['friction_coeff2_bogie']}" />
  <xacro:property name="stiffness_bogie" value="${yaml_dict['stiffness_bogie']}" />
  <xacro:property name="damping_bogie" value="${yaml_dict['damping_bogie']}" />

  <!-- **************** GAZEBO PLUGIN FOR MIMICING JOINTS **************** -->
  <xacro:macro name="mimic_joint_plugin_gazebo"
               params="name_prefix parent_joint mimic_joint has_pid:=false multiplier:=1.0 offset:=0 sensitiveness:=0.0 max_effort:=1.0 robot_namespace:=''">
    <gazebo>
      <plugin name="${name_prefix}mimic_joint_plugin" filename="libroboticsgroup_gazebo_mimic_joint_plugin.so">
        <joint>${parent_joint}</joint>
        <mimicJoint>${mimic_joint}</mimicJoint>
        <xacro:if value="${has_pid}">
          <hasPID />
        </xacro:if>
        <multiplier>${multiplier}</multiplier>
        <offset>${offset}</offset>
        <sensitiveness>${sensitiveness}</sensitiveness>
        <maxEffort>${max_effort}</maxEffort>
        <xacro:unless value="${robot_namespace == ''}">
          <robotNamespace>${robot_namespace}</robotNamespace>
        </xacro:unless>
      </plugin>
    </gazebo>
  </xacro:macro>

  <xacro:mimic_joint_plugin_gazebo 
    name_prefix="left_rocker_joint"
    parent_joint="right_rocker_joint"
    mimic_joint="left_rocker_joint"
    has_pid="false"
    multiplier="-1.0"
    max_effort="1000.0" />

  <!-- ********************************** GEOMETRY ********************************** -->
  <link
    name="left_rocker">
    <inertial>
      <origin
        xyz="0.0093907 -0.081315 0.033982"
        rpy="0 0 0" />
      <mass
        value="0.54518" />
      <inertia
        ixx="0.00071766"
        ixy="-5.98E-05"
        ixz="8.8606E-07"
        iyy="0.00030463"
        iyz="7.6825E-08"
        izz="0.0008578" />
    </inertial>
    <visual>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://oslr_description/models/oslr/meshes/left_rocker.STL" />
      </geometry>
      <material
        name="">
        <color
          rgba="0.89804 0.91765 0.92941 1" />
      </material>
    </visual>
    <collision>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://oslr_description/models/oslr/meshes/left_rocker.STL" />
      </geometry>
    </collision>
  </link>
  <joint
    name="left_rocker_joint"
    type="revolute">
    <origin
      xyz="-0.173736 0.190375827761485 -0.0594359999999915"
      rpy="1.57079632679488 1.5707963267949 0" />
    <parent
      link="base_link" />
    <child
      link="left_rocker" />
    <axis
      xyz="0 0 -1" />
    <limit
      lower="${rocker_limit_lower}"
      upper="${rocker_limit_upper}"
      effort="0"
      velocity="0" />
    <mimic
      joint="right_rocker_joint"
      multiplier="-1"
      offset="0" />
  </joint>
  <link
    name="left_bogie">
    <inertial>
      <origin
        xyz="0.11231 -0.038529 0.35308"
        rpy="0 0 0" />
      <mass
        value="0.5727" />
      <inertia
        ixx="0.0003158"
        ixy="7.6325E-05"
        ixz="3.8124E-08"
        iyy="0.00032094"
        iyz="8.1409E-07"
        izz="0.00046244" />
    </inertial>
    <visual>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://oslr_description/models/oslr/meshes/left_bogie.STL" />
      </geometry>
      <material
        name="">
        <color
          rgba="0.89804 0.91765 0.92941 1" />
      </material>
    </visual>
    <collision>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://oslr_description/models/oslr/meshes/left_bogie.STL" />
      </geometry>
    </collision>
  </link>
  <joint
    name="left_lb_axis"
    type="continuous">
    <origin
      xyz="0.102072501603827 0.187180386097456 0.38509857776149"
      rpy="-3.14159263778426 0 1.57079617385391" />
    <parent
      link="left_rocker" />
    <child
      link="left_bogie" />
    <axis
      xyz="0 0 -1" />
    <limit
      lower="0"
      upper="0"
      effort="0"
      velocity="0" />
  </joint>
  <link
    name="right_rocker">
    <inertial>
      <origin
        xyz="-0.081408 0.0085528 0.03461"
        rpy="0 0 0" />
      <mass
        value="0.54518" />
      <inertia
        ixx="0.00030587"
        ixy="-6.406E-05"
        ixz="-6.7746E-08"
        iyy="0.00071641"
        iyz="-8.8677E-07"
        izz="0.0008578" />
    </inertial>
    <visual>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://oslr_description/models/oslr/meshes/right_rocker.STL" />
      </geometry>
      <material
        name="">
        <color
          rgba="0.89804 0.91765 0.92941 1" />
      </material>
    </visual>
    <collision>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://oslr_description/models/oslr/meshes/right_rocker.STL" />
      </geometry>
    </collision>
  </link>
  <joint
    name="right_rocker_joint"
    type="revolute">
    <origin
      xyz="-0.173736 -0.190624172238515 -0.0594359999999888"
      rpy="-1.5707963267949 0 0" />
    <parent
      link="base_link" />
    <child
      link="right_rocker" />
    <axis
      xyz="0 0 1" />
    <limit
      lower="${rocker_limit_lower}"
      upper="${rocker_limit_upper}"
      effort="0"
      velocity="0" />
  </joint>
  <link
    name="right_bogie">
    <inertial>
      <origin
        xyz="0.10919 -0.034171 -0.35286"
        rpy="0 0 0" />
      <mass
        value="0.5756" />
      <inertia
        ixx="0.00031636"
        ixy="7.664E-05"
        ixz="3.8142E-08"
        iyy="0.00032122"
        iyz="9.6276E-07"
        izz="0.00046272" />
    </inertial>
    <visual>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://oslr_description/models/oslr/meshes/right_bogie.STL" />
      </geometry>
      <material
        name="">
        <color
          rgba="0.89804 0.91765 0.92941 1" />
      </material>
    </visual>
    <collision>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://oslr_description/models/oslr/meshes/right_bogie.STL" />
      </geometry>
    </collision>
  </link>
  <joint
    name="right_rb_axis"
    type="continuous">
    <origin
      xyz="0.188216650413261 0.100148831558874 0.384524249999976"
      rpy="0 0 0" />
    <parent
      link="right_rocker" />
    <child
      link="right_bogie" />
    <axis
      xyz="0 0 -0.999999999999974" />
    <limit
      lower="0"
      upper="0"
      effort="0"
      velocity="0" />
  </joint>

  <!-- ***************** GAZEBO PROPERTIES ***************** -->
  <gazebo reference="left_rocker">
      <mu1>${friction_coeff1_bogie}</mu1>
      <mu2>${friction_coeff2_bogie}</mu2>
      <kp>${stiffness_bogie}</kp>
      <kd>${damping_bogie}</kd>
      <material>Gazebo/White</material>
  </gazebo>
  
  <gazebo reference="left_bogie">
      <mu1>${friction_coeff1_bogie}</mu1>
      <mu2>${friction_coeff2_bogie}</mu2>
      <kp>${stiffness_bogie}</kp>
      <kd>${damping_bogie}</kd>
      <material>Gazebo/White</material>
  </gazebo>

  <gazebo reference="right_rocker">
      <mu1>${friction_coeff1_bogie}</mu1>
      <mu2>${friction_coeff2_bogie}</mu2>
      <kp>${stiffness_bogie}</kp>
      <kd>${damping_bogie}</kd>
      <material>Gazebo/White</material>
  </gazebo>
  
  <gazebo reference="right_bogie">
      <mu1>${friction_coeff1_bogie}</mu1>
      <mu2>${friction_coeff2_bogie}</mu2>
      <kp>${stiffness_bogie}</kp>
      <kd>${damping_bogie}</kd>
      <material>Gazebo/White</material>
  </gazebo>

</robot>